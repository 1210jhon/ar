<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>AR.js A-Frame Location-based</title>
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.7/three.js/build/ar-threex-location-only.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.7/aframe/build/aframe-ar.js"></script>
  <style>
    #coords {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: #000;
      color: #fff;
      padding: 8px;
      font-family: monospace;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <a-scene vr-mode-ui="enabled: false"
           arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false"
           renderer="antialias: true; alpha: true">

    <a-camera gps-new-camera rotation-reader></a-camera>

  </a-scene>

  <div id="coords">Esperando coordenadas...</div>

  <script>
    // GeoJSON con puntos y tuber칤as
    const geojson = {
      "type": "FeatureCollection",
      "features": [
        {
          "type": "Feature",
          "properties": { "type": "Tanque", "name": "Tanque Principal" },
          "geometry": {
            "type": "Point",
            "coordinates": [-78.930637, -7.352577] // tu posici칩n exacta
          }
        },
        {
          "type": "Feature",
          "properties": { "type": "Pozo", "name": "Pozo 1" },
          "geometry": {
            "type": "Point",
            "coordinates": [-78.930660, -7.352544] // ~1 m al norte
          }
        },
        {
          "type": "Feature",
          "properties": { "type": "V치lvula", "name": "V치lvula 1" },
          "geometry": {
            "type": "Point",
            "coordinates": [-78.930669, -7.352553] // ~1 m al este
          }
        },
        {
          "type": "Feature",
          "properties": { "type": "Pozo", "name": "Pozo 2" },
          "geometry": {
            "type": "Point",
            "coordinates": [-78.930651, -7.352553] // ~1 m al oeste
          }
        },
        {
          "type": "Feature",
          "properties": { "type": "Tuber칤a", "name": "Conexi칩n Tanque - Pozo 1" },
          "geometry": {
            "type": "LineString",
            "coordinates": [
              [-78.930660, -7.352553],
              [-78.930660, -7.352544]
            ]
          }
        },
        {
          "type": "Feature",
          "properties": { "type": "Tuber칤a", "name": "Conexi칩n Tanque - V치lvula 1" },
          "geometry": {
            "type": "LineString",
            "coordinates": [
              [-78.930660, -7.352553],
              [-78.930669, -7.352553]
            ]
          }
        },
        {
          "type": "Feature",
          "properties": { "type": "Tuber칤a", "name": "Conexi칩n Tanque - Pozo 2" },
          "geometry": {
            "type": "LineString",
            "coordinates": [
              [-78.930660, -7.352553],
              [-78.930651, -7.352553]
            ]
          }
        }
      ]
    };

    const camera = document.querySelector('[gps-new-camera]');
    const coordsDiv = document.getElementById('coords');

    camera.addEventListener('gps-camera-update-position', e => {
      const lat = e.detail.position.latitude.toFixed(6);
      const lon = e.detail.position.longitude.toFixed(6);
      coordsDiv.textContent = `Lat: ${lat}, Lon: ${lon}`;
      console.log("游늸 Posici칩n actual c치mara:", lat, lon);

      if (window._geojsonAdded) return; // Evita duplicados

      geojson.features.forEach(f => {
        if (f.geometry.type === "Point") {
          const [lon, lat] = f.geometry.coordinates;
          const el = document.createElement("a-box");
          el.setAttribute("gps-new-entity-place", `latitude: ${lat}; longitude: ${lon}`);
          el.setAttribute("color", "blue");
          el.setAttribute("scale", "5 5 5");
          document.querySelector("a-scene").appendChild(el);
        }

        if (f.geometry.type === "LineString") {
          const coords = f.geometry.coordinates;
          coords.forEach(([lon, lat]) => {
            const sphere = document.createElement("a-sphere");
            sphere.setAttribute("gps-entity-place", `latitude: ${lat}; longitude: ${lon}`);
            sphere.setAttribute("radius", "1.5");
            sphere.setAttribute("color", "red");
            document.querySelector("a-scene").appendChild(sphere);
          });
        }
      });

      window._geojsonAdded = true;
    });
  </script>
</body>
</html>
